<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
	<title>Content Management Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tinymce/tinymce-jquery@2/dist/tinymce-jquery.min.js"></script>
    <script src="https://cdn.tiny.cloud/1/rw00kgcgf2ggfyp0mu3e3upwp7b7f8y6daf38ksflv1g42y3/tinymce/6/tinymce.min.js"
        referrerpolicy="origin"></script>
		<script src="https://cdn.jsdelivr.net/npm/xregexp/xregexp-all.min.js"></script>


    <style>
        * {
            font-family: Calibri;
            font-size: 18px;
        }

        .container {
            text-align: center;
            margin-bottom: 20px;
        }

        button {

            transition-duration: 0.4s;
            font-size: 16px;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 12px;
            border: #90EE90;
            background-color: #32CD32;
            color: black;
            font-weight: bold;
        }

        button:hover {
            background-color: #F0E68C;
            color: black;
        }
        
		button:active {
			box-shadow: 0 5px #666;
			transform: translateY(4px);
		}

        .tools,
        .stats {
            display: none;
            margin-top: 10px;
            padding: 10px;
            text-align: left;
        }

        .tools.show,
        .stats.show {
            display: block;
        }

        .return-to-top-button {
            position: fixed;
            font-size: 18px;
            bottom: 10px;
            left: 10px;
            padding: 5px 10px;
            cursor: pointer;
            background-color: #cae8ca;
            border: 2px solid #4CAF50;
            z-index: 1;
        }

        .container {
            display: flex;
            margin-top: 1%;
        }

        .keywords {
            width: 35%;
            margin-left: 1%;
            border-radius: 11px;
            border: 2px solid #ededed;
            padding: 1%;
        }

        .hemingway-area {
            width: 35%;
            margin-left: 1%;
            border-radius: 11px;
            border: 2px solid #ededed;
            padding: 1%;
            z-index: 999;
        }
		
		.help-area {
            width: 35%;
            margin-left: 1%;
            border-radius: 11px;
            border: 2px solid #ededed;
            padding: 1%;
            z-index: 999;
        }
		
		.list-to-column {
            width: 35%;
            margin-left: 1%;
            border-radius: 11px;
            border: 2px solid #ededed;
            padding: 1%;
            z-index: 999;
        }

        .editor {
            width: 65%;
        }

        .keywords textarea {
            display: none;
            /* Hide the textarea by default */
            width: calc(100% - 20px);
            margin-bottom: 10px;
            resize: vertical;
        }

        .keywords button {
            padding: 8px;
            cursor: pointer;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .tools-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .stats-container {
            display: flex;
            flex-wrap: wrap;
            /* Allow wrapping to create multiple rows */
            justify-content: space-between;
            /* Distribute items evenly between the two columns */
            gap: 20px;
            /* Add gap between items */
        }

        .stats {
            flex: 0 0 calc(50% - 10px);
            /* Specify initial size for each column with some spacing */
            margin-bottom: 20px;
            /* Add margin to create space between rows */
        }


        .highlighted {
            background-color: #FFA500;
        }
		
        .adverb {
            background: #c4e3f3;
        }

        .qualifier {
            background: #c4e3f3;
        }

        .passive {
            background: #c4ed9d;
        }

        .complex {
            background: #e3b7e8;
        }

        .hardSentence {
            background: #f7ecb5;
        }

        .veryHardSentence {
            background: #e4b9b9;
        }

        .counter {
            position: relative;
            padding: 5% 5%;
            margin: 5% 0 0 5%;
            border-radius: 8px;
        }

        th {
            text-align: center;
        }
		
		#output {
            width: 100%;
            height: 100%;
            overflow: auto;
            margin-top: 10px;
            border: 1px solid #000;
        }
    </style>
</head>

<body>
    <div class="tools-container">
        <button class="tools-button" onclick="toggleTools()">Tools</button>
        <button class="stats-button" onclick="toggleStats()">Stats</button>
        <button  class="help-button" onclick="toggleHelp()">Help</button>
        <div class="tools" id="tools">
            <button class="clean-lists" onclick="cleanBulletPoints()">Fix Formatting</button>
            <button class="capitalize-headings" onclick="capitalizeHeadings()">Capitalize Headings</button>
            <button class="repetition-checker" onclick="findAndHighlightWordRepeats()">Repetition Checker</button>
            <button class="hemingway-tool">Hemingway Tool</button>
			<button class="list-column-btn" onclick="toggleList">List to Column</button>
        </div>
        <div class="stats" id="stats">
            <div class="stats-container">
                <p>Total number of keywords: <span id="total-keywords">-</span></p>
                <p>% of keywords used: <span id="keywords-percentage">-</span></p>
                <p>Keyword Proximity: <span id="keyword-proximity">-</span></p>
            </div>
        </div>

        <div class="container">

            <div class="editor">
                <textarea id="tiny" placeholder="Write or Paste your text here"></textarea>
                <button class="return-to-top-button" onclick="returnToTop()">&#x21E7;</button>
            </div>

            <div class="hemingway-area" style="display: none;">
                <div id="right">
                    <button class="HemBtn" onclick="HemingwayCalculator()">Test Me</button>
                    <button onclick="RemoveHemFormat()">Remove Formatting</button>
                    <p>Hemingway Grade: <span id="hemingway-grade">-</span></p>
                    <div id="adverb" class="adverb counter"></div>
                    <div id="passive" class="passive counter"></div>
                    <div id="complex" class="complex counter"></div>
                    <div id="hardSentence" class="hardSentence counter"></div>
                    <div id="veryHardSentence" class="veryHardSentence counter"></div>
                </div>
            </div>
			
			<div class="list-to-column" style="display: none;">
				<div id="right">
					<textarea id="input" placeholder="Enter words separated by commas"></textarea><br>
					<button onclick="transform()">Transform</button>
					<div id="output"></div>
				</div>
			</div>
			
			<div class="help-area" style="display: none;">
				<div id="right">
					<h1 style="text-align: center; font-size: 22px;">Help</h1>
					<div style="text-align: left;"><p><strong>Fix Formatting</strong>: removes empty paragraphs, leading and trailing spaces and 2+ whitespace. It also cleans bullet points to make the text pastable into GDocs or Word Docs without issues.</p>
					<p><strong>Capitalize Headings:</strong> follows APA Style. It's primarily for English but should work also in German, Spanish, French and Italian (still better to double-check to avoid mistakes).</p>
					<p><strong>Repetition Checker:</strong> highlights in yellow words repeated twice within 10 words.</p>
					<p><strong>Hemingway Tool:</strong> Work in progress.</p>
					<p><strong>Add Keywords:</strong> accepts one keyword per line.</p>
					<p><strong>Add Required Amount:</strong> accepts numbers (10), ranges (1-20 or 1 - 20), and percentages (5%). One per line, they'll correspond to the line of the "Add Keywords" section. If no data, default range is 1-100.</p>
					<p><strong>Analyze Keywords:</strong> activates the keyword analysis. Results in the table update only when this button is clicked. Clicking also calculates Stats shown in the relevant tab.</p>
					<p><strong>Exact Matches:</strong> returns the number of occurrences and density percentage of words exactly as inserted in the keyword area.</p>
					<p><strong>Partial Matches:</strong> returns the number of occurrences of words that have slight differences with the provided keyword, such as prefixes, suffixes and diacritics. (keyword = cafè; partial matches are "cafe", "cafès", "ecafè"). The density percentage shown includes the density of "Exact Matches".</p>
					</div>
				</div>
			</div>

            <div class="keywords">
                <textarea id="keywordInput" placeholder="Paste your keywords here"></textarea>
                <textarea id="requiredAmountInput" placeholder="Insert required amounts (one per line)"
                    style="display: none;"></textarea>
                <button id="addKeywordsBtn">Add Keywords</button>
                <button id="addRequiredAmountBtn">Add Required Amount</button>
                <button id="analyzeKeywordsBtn" onclick="analyzeKeywords()">Analyze Keywords</button>
                <h3>Keyword Results</h3>
                <table id="keywordResults">
                    <thead>
                        <tr>
                            <th>Keyword</th>
                            <th>Exact Matches</th>
                            <th>Partial Matches</th>
                            <th>Required</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        $('textarea#tiny').tinymce({
            height: 500,
            menubar: false,
            browser_spellcheck: true,
            entity_encoding: 'raw', // or 'named'
            selector: 'textarea#tiny',
            contextmenu: false,
            plugins: [
                'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
                'anchor', 'searchreplace', 'visualblocks', 'fullscreen',
                'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount', 'paste'
            ],
            toolbar: ' blocks | bold italic backcolor | ' +
                'alignleft aligncenter alignright alignjustify | ' +
                'bullist numlist outdent indent | table | ' +
                'link | image | media | ' +
                'removeformat | undo redo | wordcount | searchreplace | help',
            menu: {
                file: { title: 'File', items: 'newdocument restoredraft | preview | export | print | deleteallconversations' },
                edit: { title: 'Edit', items: 'undo redo | cut copy paste pastetext | selectall | searchreplace' },
                view: { title: 'View', items: 'code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments' },
                insert: { title: 'Insert', items: 'image link media addcomment pageembed template codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor tableofcontents | insertdatetime' },
                format: { title: 'Format', items: 'bold italic underline strikethrough superscript subscript codeformat | styles blocks fontfamily fontsize align lineheight | forecolor backcolor | language | removeformat' },
                tools: { title: 'Tools', items: 'spellchecker spellcheckerlanguage | a11ycheck code wordcount' },
                table: { title: 'Table', items: 'inserttable | cell row column | advtablesort | tableprops deletetable' },
                help: { title: 'Help', items: 'help' }
            },
            menubar: 'favs file edit view insert format tools table help',
            content_css: 'css/content.css',
            paste_retain_style_properties: 'all',
            paste_webkit_styles: 'all',
            paste_word_valid_elements: "b,strong,i,em,li,ol,ul"

        });
		
		//Keyword Checker
function analyzeKeywords() {
    console.log("Analyzing keywords...");
    try {
        var editor = tinymce.get('tiny');
        if (!editor) {
            console.error("TinyMCE editor not found.");
            return;
        }
        
        var totalWordCount = editor.plugins.wordcount.getCount();
        var keywordInput = document.getElementById('keywordInput');
        if (!keywordInput) {
            console.error("Keyword input element not found.");
            return;
        }
        
        var keywords = keywordInput.value.split('\n').map(keyword => keyword.trim()).filter(Boolean);
        var requiredAmountInput = document.getElementById('requiredAmountInput');
        if (!requiredAmountInput) {
            console.error("Required amount input element not found.");
            return;
        }
        
        var requiredAmounts = requiredAmountInput.value.split('\n').map(entry => entry.trim()).filter(Boolean);
        var content = editor.getContent({ format: 'text' });

        var keywordResultsTable = document.getElementById('keywordResults').getElementsByTagName('tbody')[0];
        if (!keywordResultsTable) {
            console.error("Keyword results table not found.");
            return;
        }
        
        keywordResultsTable.innerHTML = '';

        var totalKeywords = keywords.length; // Calculate total number of keywords

        keywords.forEach(function (keyword, index) {
            // Create a case-insensitive regular expression to match the keyword as a whole word
            var pattern = new RegExp('(?<=^|\\s|[\'"“”\\(\\)])' + escapeRegExp(keyword) + '(?=[\\s.,;:!?\'"“”\\(\\)]|$)', 'gi');



            // Find exact matches and partial matches
            var matches = content.match(pattern) || [];
            var exactMatches = countExactMatches(matches, keyword);
            var partialMatches = countPartialMatches(content, keyword);

            var row = keywordResultsTable.insertRow();
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);

            cell1.innerHTML = keyword;
            cell2.innerHTML = exactMatches + "<br>" + " (" + ((exactMatches / totalWordCount) * 100).toFixed(2) + '%' + ")";
            cell3.innerHTML = partialMatches - exactMatches + "<br>" + " (" + (partialMatches / totalWordCount * 100).toFixed(2) + '%)';
            cell4.innerHTML = formatRequiredAmount(parseRequiredAmount(requiredAmounts[index]));

            // Check if the actual count is within the specified range
            var countInRange = isCountInRange(exactMatches, parseRequiredAmount(requiredAmounts[index]));
            cell4.className = countInRange ? 'count-in-range' : 'count-out-of-range';

            // Add visual hints based on comparison
            addVisualHints(cell4, exactMatches, parseRequiredAmount(requiredAmounts[index]), totalWordCount);
        });

        // Update the display of total number of keywords in Stats
        var totalKeywordsElement = document.getElementById('total-keywords');
        if (totalKeywordsElement) {
            totalKeywordsElement.textContent = totalKeywords;
        } else {
            console.error("Total keywords element not found.");
        }

        calculateKeywordsPercentage();
    } catch (error) {
        console.error("An error occurred during keyword analysis:", error);
    }
}

// Function to count exact matches of a keyword in the content
function countExactMatches(matches, keyword) {
    var count = 0;
    matches.forEach(function (match) {
        if (match === keyword || containsEquivalentDiacritics(match, keyword), 'gi') {
            count++;
        }
    });
    return count;
}

// Function to count partial matches considering diacritics and different character sets
function countPartialMatches(content, keyword) {
    var normalizedContent = normalizeDiacritics(content);
    var partialPattern = new RegExp(normalizeDiacritics(keyword), 'gi');
    var matches = normalizedContent.match(partialPattern) || [];
    return matches.length;
}

// Function to check if a string contains equivalent diacritics of a keyword
function containsEquivalentDiacritics(str, keyword) {
    var normalizedStr = normalizeDiacritics(str);
    var normalizedKeyword = normalizeDiacritics(keyword);
    return normalizedStr !== normalizedKeyword && normalizedStr.includes(normalizedKeyword);
}


// Function to normalize diacritics in a string
function normalizeDiacritics(str) {
    return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
}


// Function to escape special characters in a string for use in regular expressions
function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

// Function to check if keywords are equivalent considering diacritics
function areKeywordsEquivalent(keyword1, keyword2) {
    return normalizeDiacritics(keyword1) === normalizeDiacritics(keyword2);
}

        function addVisualHints(cell, exactMatches, requiredAmount, totalWordCount) {
            if (typeof requiredAmount === 'number') {
                // Case 1: Required is an integer
                addVisualHintForInteger(cell, exactMatches, requiredAmount);
            } else if (typeof requiredAmount === 'object' && requiredAmount.min !== undefined && requiredAmount.max !== undefined) {
                // Case 2: Required is a Range
                addVisualHintForRange(cell, exactMatches, requiredAmount);
            } else if (typeof requiredAmount === 'object' && requiredAmount.percentage !== undefined) {
                // Case 3: Required is a Percentage
                addVisualHintForPercentage(cell, exactMatches, requiredAmount, totalWordCount);
            } else if (typeof requiredAmount === 'object' && ('percentage' in requiredAmount)) {
                // Case 4: Required is a Percentage Range
                addVisualHintForPercentageRange(cell, exactMatches, { percentage: requiredAmount }, totalWordCount);
            }
        }


        function addVisualHintForInteger(cell, exactMatches, requiredAmount) {
            var difference = Math.abs(exactMatches - requiredAmount);

            if (difference === 0) {
                cell.style.backgroundColor = 'green'; // Numbers are the same
            } else if (difference === 1) {
                cell.style.backgroundColor = 'orange'; // Difference is +/- 1
            } else {
                cell.style.backgroundColor = 'red'; // Difference is higher than +/- 1
            }
        }

        function addVisualHintForRange(cell, exactMatches, requiredAmount) {
            if (exactMatches >= requiredAmount.min && exactMatches <= requiredAmount.max) {
                cell.style.backgroundColor = 'green'; // Exact match is within the range
            } else if (Math.abs(exactMatches - requiredAmount.min) === 1 || Math.abs(exactMatches - requiredAmount.max) === 1) {
                cell.style.backgroundColor = 'orange'; // Difference is +/- 1 from the range
            } else {
                cell.style.backgroundColor = 'red'; // Difference is higher than +/- 1 from the range
            }
        }

        function addVisualHintForPercentage(cell, exactMatches, requiredAmount, totalWordCount) {
            var requiredPercentage = (exactMatches / totalWordCount) * 100;

            // Calculate the absolute difference
            var difference = Math.abs(requiredPercentage - requiredAmount.percentage);

            if (difference <= 0.5) {
                cell.style.backgroundColor = 'orange'; // Difference is within +/- 0.5%
            } else if (requiredPercentage.toFixed(2) === requiredAmount.percentage.toFixed(2)) {
                cell.style.backgroundColor = 'green'; // Percentages are the same
            } else {
                cell.style.backgroundColor = 'red'; // Percentages are different and outside tolerance
            }
        }

        function addVisualHintForPercentageRange(cell, exactMatches, requiredAmount, totalWordCount) {
            // Check if requiredAmount contains a range (e.g., "1%-2%" or "1% - 2%")
            if ('percentageMin' in requiredAmount && 'percentageMax' in requiredAmount) {
                // Extract min and max values from the range
                var requiredPercentageMin = requiredAmount.percentageMin;
                var requiredPercentageMax = requiredAmount.percentageMax;

                // Calculate the percentage based on exactMatches and totalWordCount
                var calculatedPercentage = (exactMatches / totalWordCount) * 100;

                if (!isNaN(requiredPercentageMin) && !isNaN(requiredPercentageMax)) {
                    // Percentage is within the range
                    if (calculatedPercentage >= requiredPercentageMin && calculatedPercentage <= requiredPercentageMax) {
                        cell.style.backgroundColor = 'green';
                    }
                    // Difference is within +/- 0.5% from the range
                    else if (Math.abs(calculatedPercentage - requiredPercentageMin) <= 0.5 || Math.abs(calculatedPercentage - requiredPercentageMax) <= 0.5) {
                        cell.style.backgroundColor = 'orange';
                    }
                    // Difference is higher than +/- 0.5% from the range
                    else {
                        cell.style.backgroundColor = 'red';
                    }
                }
            } else {
                // Handle single percentage case
                addVisualHintForPercentage(cell, exactMatches, requiredAmount, totalWordCount);
            }
        }


        function parseRequiredAmount(entry) {
            // Check if the entry is empty
            if (!entry) {
                return { min: 1, max: 100 }; // Return range between 1 and 100 if empty
            }

            // Check if the entry is a percentage range
            if (entry.includes('%')) {
                var rangeValues = entry.split('-').map(val => val.trim());
                if (rangeValues.length === 2 && !isNaN(parseFloat(rangeValues[0])) && !isNaN(parseFloat(rangeValues[1]))) {
                    return { percentageMin: parseFloat(rangeValues[0]), percentageMax: parseFloat(rangeValues[1]) };
                }
            }

            // Check if the entry is a percentage
            if (entry.endsWith('%')) {
                var percentage = parseFloat(entry.slice(0, -1));
                return { percentage: percentage };
            }

            // Check if the entry is an integer range
            if (entry.includes('-')) {
                var rangeValues = entry.split('-').map(val => parseInt(val.trim()));
                if (rangeValues.length === 2 && !isNaN(rangeValues[0]) && !isNaN(rangeValues[1])) {
                    return { min: rangeValues[0], max: rangeValues[1] };
                }
            }

            // Treat as a single integer
            var intValue = parseInt(entry);
            return isNaN(intValue) ? 0 : intValue;
        }

        function formatRequiredAmount(requiredAmount) {
            if (typeof requiredAmount === 'number') {
                return requiredAmount.toString();
            } else if (typeof requiredAmount === 'object' && requiredAmount.percentage !== undefined) {
                return requiredAmount.percentage + '%';
            } else if (typeof requiredAmount === 'object' && requiredAmount.min !== undefined && requiredAmount.max !== undefined) {
                return requiredAmount.min + ' - ' + requiredAmount.max;
            }
            return '';
        }

        function isCountInRange(count, requiredAmount) {
            if (typeof requiredAmount === 'number') {
                return count >= requiredAmount;
            } else if (typeof requiredAmount === 'object' && requiredAmount.min !== undefined && requiredAmount.max !== undefined) {
                return count >= requiredAmount.min && count <= requiredAmount.max;
            }
            return false;
        }

        function calculateKeywordsPercentage() {
            var editor = tinymce.get('tiny');
            var totalWordCount = editor.plugins.wordcount.getCount();
            var keywordInput = document.getElementById('keywordInput');
            var keywords = keywordInput.value.split('\n').map(keyword => keyword.trim()).filter(Boolean);
            var requiredAmountInput = document.getElementById('requiredAmountInput');
            var requiredAmounts = requiredAmountInput.value.split('\n').map(entry => entry.trim()).filter(Boolean);
            var usedKeywordsCount = 0;

            keywords.forEach(function (keyword, index) {
                var escapedKeyword = escapeRegExp(keyword);
                var requiredAmount = parseRequiredAmount(requiredAmounts[index]);
                var pattern = new RegExp('(?:\\p{L}|\\W)' + escapedKeyword + '(?:\\p{L}|\\W)', 'giu');
                var content = editor.getContent({ format: 'text' });
                var matches = content.match(pattern) || [];
                var exactMatches = matches.length;

                if (isCountInRange(exactMatches, requiredAmount)) {
                    usedKeywordsCount++;
                }
            });

            var keywordsPercentage = (usedKeywordsCount / keywords.length) * 100;
            var keywordsPercentageElement = document.getElementById('keywords-percentage');
            keywordsPercentageElement.textContent = keywordsPercentage.toFixed(2) + '%';
        }

        // Bind the function to the "Calculate" button click event
        var analyzeKeywordsBtn = document.getElementById('analyzeKeywordsBtn');
        analyzeKeywordsBtn.addEventListener('click', function () {
            calculateKeywordsPercentage();
        });
		
		//End of Keyword Checker
		
function toggleList() {
    var listArea = document.querySelector('.list-to-column');
    var listButton = document.querySelector('.list-column-btn');

    if (listArea.style.display === 'none' || listArea.style.display === '') {
        listArea.style.display = 'block';
        listButton.textContent = 'Hide List to Column';
    } else {
        listArea.style.display = 'none';
        listButton.textContent = 'List to Column';
    }

    // Toggle the visibility of the Keyword area as well
    var keywordArea = document.querySelector('.keywords');
    keywordArea.style.display = listArea.style.display === 'block' ? 'none' : 'block';
}

// Bind the function to the button click event
var listButton = document.querySelector('.list-column-btn');
listButton.addEventListener('click', toggleList);
		
		function transform() {
            var input = document.getElementById('input').value;
            var words = input.split(',');
            var output = document.getElementById('output');
            output.innerHTML = '';
            for (var i = 0; i < words.length; i++) {
                output.innerHTML += words[i].trim() + '<br>';
            }
        }
		
		function toggleHelp() {
			var helpArea = document.querySelector('.help-area');
			var helpButton = document.querySelector('.help-button');
			
			if (helpArea.style.display === 'none') {
                helpArea.style.display = 'block';
                helpButton.textContent = 'Hide Help';
            } else {
                helpArea.style.display = 'none';
                helpButton.textContent = 'Help';
            }

            // Toggle the visibility of the Keyword area as well
            var keywordArea = document.querySelector('.keywords');
            keywordArea.style.display = helpArea.style.display === 'block' ? 'none' : 'block';
        }

        // Bind the function to the button click event
        var helpButton = document.querySelector('.hemingway-tool');
        helpButton.addEventListener('click', toggleHemingwayTool);
		
		function toggleTools() {
            var instructions = document.getElementById('tools');
            instructions.classList.toggle('show');

            var toolsButton = document.querySelector('.tools-button');
            toolsButton.textContent = instructions.classList.contains('show') ? 'Hide Tools' : 'Tools';
        }

        function toggleStats() {
            var statsArea = document.getElementById('stats');
            statsArea.classList.toggle('show');

            var statsButton = document.querySelector('.stats-button');
            statsButton.textContent = statsArea.classList.contains('show') ? 'Hide Stats' : 'Stats';
        }

        var addKeywordsBtn = document.getElementById('addKeywordsBtn');
        var keywordInput = document.getElementById('keywordInput');

        keywordInput.style.display = 'none';

        addKeywordsBtn.addEventListener('click', function () {
            if (keywordInput.style.display === 'none') {
                keywordInput.style.display = 'block';
                addKeywordsBtn.textContent = 'Hide Keywords';
            } else {
                keywordInput.style.display = 'none';
                addKeywordsBtn.textContent = 'Add Keywords';
            }
        });

        var addRequiredAmountBtn = document.getElementById('addRequiredAmountBtn');
        var requiredAmountInput = document.getElementById('requiredAmountInput');

        addRequiredAmountBtn.addEventListener('click', function () {
            if (requiredAmountInput.style.display === 'none') {
                requiredAmountInput.style.display = 'block';
                addRequiredAmountBtn.textContent = 'Hide Required Amount';
            } else {
                requiredAmountInput.style.display = 'none';
                addRequiredAmountBtn.textContent = 'Add Required Amount';
            }
        });

function fixSpaces() {
    var editor = tinymce.get('tiny');
    var content = editor.getContent({ format: 'html' });

    // Use a DOMParser to parse the string into a document object
    var parser = new DOMParser();
    var doc = parser.parseFromString(content, 'text/html');

    // Function to trim leading and trailing spaces from the first and last span elements
    function trimSpanSpaces(element) {
        var firstSpan = element.querySelector('span');
        var lastSpan = element.querySelector('span:last-child');
        
        if (firstSpan && firstSpan === lastSpan) {
            // If there's only one span, trim both leading and trailing spaces
            firstSpan.textContent = firstSpan.textContent.trim();
        } else {
            // If there are multiple spans, trim the first and last ones separately
            if (firstSpan) {
                firstSpan.textContent = firstSpan.textContent.replace(/^\s+/, '');
            }
            if (lastSpan) {
                lastSpan.textContent = lastSpan.textContent.replace(/\s+$/, '');
            }
        }
    }

    // Function to replace multiple spaces with a single space within text nodes
    function singleSpaceTextNodes(node) {
        if (node.nodeType === 3) {
            node.nodeValue = node.nodeValue.replace(/\s{2,}/g, ' ');
        } else {
            Array.from(node.childNodes).forEach(singleSpaceTextNodes);
        }
    }

    // Apply trimming to the first and last span elements of paragraphs and headings
    var tagsToTrim = ['P', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6'];
    tagsToTrim.forEach(function(tag) {
        doc.querySelectorAll(tag).forEach(trimSpanSpaces);
    });

    // Replace multiple spaces with a single space within text nodes
    singleSpaceTextNodes(doc.body);

    // Set the modified content back to the editor
    editor.setContent(doc.body.innerHTML);
}

// Add event listener to the button
var fixSpacesButton = document.querySelector('.clean-lists');
fixSpacesButton.addEventListener('click', fixSpaces);

		
		
        function removeEmptyParagraphs() {
            var editor = tinymce.get('tiny');
            var content = editor.getContent();

            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;

            // Select all paragraphs and headings in the content
    var elements = tempDiv.querySelectorAll('p, h1, h2, h3, h4, h5, h6');

    // Loop through elements and remove empty ones
    for (var i = elements.length - 1; i >= 0; i--) {
        var elementContent = elements[i].textContent.trim();
        if (elementContent === '') {
            elements[i].remove();
        }
    }

    editor.setContent(tempDiv.innerHTML);
}
		
        var removeEmptyParagraphsButton = document.querySelector('.clean-lists');
        removeEmptyParagraphsButton.addEventListener('click', removeEmptyParagraphs);

        function cleanBulletPoints() {
            var listItems = tinymce.activeEditor.dom.select('ul li, ol li');
            listItems.forEach(function (listItem) {
                var paragraphs = listItem.querySelectorAll('p');
                paragraphs.forEach(function (paragraph) {
                    if (paragraph.parentNode === listItem) {
                        // Move content outside of <p> elements
                        while (paragraph.firstChild) {
                            listItem.appendChild(paragraph.firstChild);
                        }
                        tinymce.activeEditor.dom.remove(paragraph);
                    }
                });
            });
        }

        function capitalizeHeadings() {
            var editor = tinymce.get('tiny');
            var content = editor.getContent();

            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;

            // Select all headings in the content
            var headings = tempDiv.querySelectorAll('h1, h2, h3, h4, h5, h6');

            // List of words to exclude from lowercase (APA style)
            var excludedWords = ['a', 'an', 'and', 'as', 'at', 'but', 'by', 'for', 'in', 'nor', 'of', 'on', 'or', 'so', 'the', 'to', 'up', 'yet', 'ad', 'al', 'allo', 'ai', 'il', 'agli', 'all', 'alla', 'alle', 'con', 'col', 'coi', 'da', 'dal', 'dallo', 'dai', 'dagli', 'dall', 'dalla', 'dalle', 'di', 'del', 'dello', 'dei', 'degli', 'dell', 'della', 'delle', 'in', 'un', 'una', 'la', 'lo', 'gli', 'nel', 'nello', 'nei', 'negli', 'nell', 'nella', 'nelle', 'su', 'sul', 'sullo', 'sui', 'sugli', 'sull', 'sulla', 'sulle', 'y', 'e', 'o', 'u', 'con', 'de', 'desde', 'en', 'entre', 'hacia', 'hasta', 'para', 'por', 'según', 'sin', 'sobre', 'tras', 'ante', 'bajo', 'cabe', 'contra', 'durante', 'mediante', 'excepto', 'salvo', 'toda', 'todas', 'todo', 'todos', 'und', 'oder', 'aber', 'denn', 'doch', 'also', 'nur', 'jedoch', 'weder', 'sowie', 'sodass', 'weil', 'dass', 'obwohl', 'trotzdem', 'falls', 'weiter', 'zwar', 'nämlich', 'ja', 'nein', 'doch', 'denn', 'auch', 'nicht', 'sehr', 'mehr', 'wenig', 'viel', 'a', 'o', 'as', 'os', 'à', 'ao', 'às', 'aos', 'de', 'do', 'da', 'dos', 'das', 'em', 'no', 'na', 'nos', 'nas', 'por', 'pelo', 'pela', 'pelos', 'pelas', 'com', 'sem', 'sob', 'sobre', 'ante', 'após', 'até', 'contra', 'entre'];

            // Function to capitalize according to APA style
            function capitalizeAPA(text) {
                return text.toLowerCase().replace(/(?:^|\s)\S/g, function (a) {
                    return a.toUpperCase();
                }).replace(new RegExp('\\b(?:' + excludedWords.join('|') + ')\\b', 'giu'), function (word) {
                    return word.toLowerCase();
                });
            }

            // Loop through headings and apply APA capitalization
            headings.forEach(function (heading) {
                var headingText = heading.textContent.trim();
                var words = headingText.split(' ');

                for (var i = 0; i < words.length; i++) {
                    if (i === 0 && excludedWords.includes(words[i].toLowerCase())) {
                        words[i] = words[i].charAt(0).toUpperCase() + words[i].slice(1).toLowerCase();
                    } else {
                        words[i] = capitalizeAPA(words[i]);
                    }
                }

                heading.textContent = words.join(' ');
            });

            editor.setContent(tempDiv.innerHTML);
        }

		

//Word Repetition Checker
function findAndHighlightWordRepeats() {
    var editor = tinymce.get('tiny');
    var rootNode = editor.getBody();
    var pattern = /\b(\w{4,})\b(?=(?:\W*\w*){0,10}\W*\1\b)/gi;

    function highlightRepeatedWords(node) {
        var text = node.nodeValue;
        var words = text.split(/\b/);
        for (var i = 0; i < words.length; i++) {
            if (words[i].length >= 4) {
                for (var j = i + 1; j < i + 11 && j < words.length; j++) {
                    if (words[i].toLowerCase() === words[j].toLowerCase()) {
                        words[i] = words[j] = '<span style="background-color: #FFA500;">' + words[i] + '</span>';
                    }
                }
            }
        }
        var highlightedText = words.join('');
        if (highlightedText !== text) {
            var wrapper = document.createElement('span');
            wrapper.innerHTML = highlightedText;
            node.parentNode.replaceChild(wrapper, node);
        }
    }

    function traverseAndHighlight(node) {
        if (node.nodeType === Node.TEXT_NODE) {
            highlightRepeatedWords(node);
        } else if (node.nodeType === Node.ELEMENT_NODE && node.childNodes) {
            for (var i = 0; i < node.childNodes.length; i++) {
                traverseAndHighlight(node.childNodes[i]);
            }
        }
    }

    traverseAndHighlight(rootNode);
}

var isHighlightingOn = false;

function toggleRepetitionHighlighting() {
    if (isHighlightingOn) {
        removeRepetitionHighlighting();
    } else {
        findAndHighlightWordRepeats();
        isHighlightingOn = true;
    }
}

function removeRepetitionHighlighting() {
    var editor = tinymce.get('tiny');
    var rootNode = editor.getBody();
    var highlightedSpans = rootNode.querySelectorAll('span[style="background-color: #FFA500;"]');

    highlightedSpans.forEach(function (span) {
        span.removeAttribute('style');
    });

    isHighlightingOn = false;
}


var repetitionCheckerBtn = document.querySelector('.repetition-checker');
repetitionCheckerBtn.addEventListener('click', toggleRepetitionHighlighting);

        //Return to Top Button
		// Add event listener for scroll event
		window.addEventListener('scroll', function() {
			// Get the height of the page
			var pageHeight = document.documentElement.scrollHeight;
			
			// Calculate the threshold for showing the button (2/3 of the page height)
			var threshold = (1/6) * pageHeight;
			
			// Get the "Return to Top" button element
			var returnToTopButton = document.querySelector('.return-to-top-button');
			
			// Show or hide the "Return to Top" button based on the scroll position
			if (window.scrollY > threshold) { // Show button if scrolled down to 2/3 of the page
				returnToTopButton.style.display = 'block';
			} else {
				returnToTopButton.style.display = 'none';
			}
		});

		// Function to scroll back to the top of the page
		function returnToTop() {
			window.scrollTo({ top: 0, behavior: 'smooth' });
		}

        
		//Hemingway Tool
		function toggleHemingwayTool() {
            var hemingwayArea = document.querySelector('.hemingway-area');
            var hemingwayToolButton = document.querySelector('.hemingway-tool');

            if (hemingwayArea.style.display === 'none') {
                hemingwayArea.style.display = 'block';
                hemingwayToolButton.textContent = 'Hide Hemingway Tool';
            } else {
                hemingwayArea.style.display = 'none';
                hemingwayToolButton.textContent = 'Hemingway Tool';
            }

            // Toggle the visibility of the Keyword area as well
            var keywordArea = document.querySelector('.keywords');
            keywordArea.style.display = hemingwayArea.style.display === 'block' ? 'none' : 'block';
        }

        // Bind the function to the button click event
        var hemingwayToolButton = document.querySelector('.hemingway-tool');
        hemingwayToolButton.addEventListener('click', toggleHemingwayTool);

function calculateLevel(letters, words, sentences) {
    if (words === 0 || sentences === 0) {
        return 0;
    }
    let level = Math.round(
        4.71 * (letters / words) + 0.5 * words / sentences - 21.43
    );
    return level <= 0 ? 0 : level;
}

function getSentenceFromParagraph(p) {
    let sentences = p
        .split(/[\.\?!]\s|\n/g)  // Split on period, exclamation mark, or question mark followed by a space, or newline
        .filter(s => s.trim().length > 0)  // Remove empty sentences
        .map(s => s.trim() + '.');  // Add a period at the end of each sentence
    return sentences;
}



function HemingwayCalculator() {
    var text = tinyMCE.activeEditor.getContent({format: 'text'}); // Use TinyMCE's API to get the content

    // Calculate the number of letters, words, and sentences
    var letters = text.replace(/[^a-z]/gi, '').length;
    var words = text.match(/\S+/g) ? text.match(/\S+/g).length : 0; // matches any non-whitespace character
    var sentences = getSentenceFromParagraph(text);
    var sentenceCount = sentences.length;
    
    // Calculate the readability level
    var level = calculateLevel(letters, words, sentenceCount); // Pass sentenceCount, not sentences

    // Display the readability level
    document.getElementById('hemingway-grade').innerText = level;
}



document.querySelector('.HemBtn').addEventListener('click', HemingwayCalculator);

    </script>
</body>

</html>